![https://github.com/devqnight](https://img.shields.io/badge/devqnight-2023-%23f514c0)

# backend-data-handling
Backend API to handle data from a PostGreSQL database using JWT Authentication.

This project comes with a docker-compose.yml file to deploy the PostGreSQL database, as well as a Redis database to handle users sessions.

You can modify the `.env` file to connect to an already existing database if you prefer to not run the docker containers.

## Frameworks and dependencies used

- NodeJS
- TypeScript
- Express
- jsonwebtoken: creation and validation of JWT
- bcryptJS: password encrypting
- TypeORM: ORM
- Zod: Input validation


## Pre-requisites
To run this project, you will need :
- nodejs 
- docker and docker-compose (if you want to run the containers)

## Setup
### Clone repository

In a new terminal, go to the desired location, and execute the following command:
```bash
git clone https://github.com/devqnight/backend-data-handling.git
```

### Install dependencies

In the same terminal, run `npm install` to install all the dependencies of the project.

### Docker-compose

Before running the project, you will need to have the databases running. 
If you want to use the docker containers, in the terminal, run the following command:

```bash
docker-compose up -d
```

This will start the PostGreSQL DB container and the Redis caching DB container.
To stop them, run:
```bash
docker-compose down
``` 
*(add the following to remove all data from the volumes : `--rmi all --volumes`)*.

### Executing the migrations

For testing with the docker PostGreSQL DB, we will need to create the tables that the project will use. To do this, we can run migrations generated by TypeORM. 
To generate and run the migrations, run the following commands: 

```bash
npm run migrate && npm run db:push
```

### Start the API

Once the previous steps are done, you can start the server.
Run:

```bash
npm run start
```
----
## API

### Endpoints

| path                  | action     | parameters         | description | protected |
|------                 |------------|------------        |-------------|-------------|
| `/api/auth/register`  | POST       | `{name: string, email: string, password: string, passwordConf: string}` | Register yourself as a new user            |
| `/api/auth/login`  | POST       | `{email: string, password: string}` | Login with your user |
| `/api/auth/logout`  | GET       | \ | Logout the current user |
| `/api/auth/refresh`  | GET       | \ | Refresh current user's accessToken |
| `/api/auth/reset`  | PUT       | `{oldPassword: string, password: string, passwordConf: string}` | Reset password for current user | Connected User
| `/api/users`  | GET       | \ | Get all users from DB | Connected User
| `/api/users/:id`  | GET       | \ | Get user from DB by Id | Connected User
| `/api/users`  | POST       | `{name: string, email: string, password: string, passwordConf: string}` | Create new User | Connected User
| `/api/users/:id`  | PUT       | `{name: string, email: string}` | Update existing User | Connected User
| `/api/users/:id`  | DELETE       | \ | Delete User | Connected User


### Validation

For input validation, the api is using Zod to validate the inputs according to a schema. 
- For passwords, they are to be between 8 and 25 characters long, and when doing a password reset, new password can't be the same as the old one.
- For emails, the email has to be valid according to the default from Zod.
- For names, it is required and can't be null.


### Testing

If you wish to use Postman to test the API, you can import the included postman collection `RESTful backend data handling.postman_collection.json`. 





